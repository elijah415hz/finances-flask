(this.webpackJsonpreact_client=this.webpackJsonpreact_client||[]).push([[0],{31:function(e,t,n){},38:function(e,t,n){},39:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n(1),c=n.n(r),o=n(23),s=n.n(o),u=(n(31),n(5)),i=n(2),d=n(25),l=n(3),j=n(18),h=n(21),b=n(10),p=n.n(b),f=n(12),O=n(8);function m(e){var t=Object(r.useState)({Amount:""}),n=Object(u.a)(t,2),c=n[0],o=n[1];function s(e,t){return Object(a.jsx)("datalist",{id:t,children:e.map((function(e){return Object(a.jsx)("option",{value:e.name},e.id)}))})}function d(e){var t=e.target,n=t.name,a=t.value;o(Object(i.a)(Object(i.a)({},c),{},Object(O.a)({},n,a)))}return Object(r.useEffect)((function(){o(e.entry)}),[e.entry]),Object(a.jsx)("tbody",{children:Object(a.jsxs)("tr",{children:[e.fields.filter((function(e){return!e.name.includes("id")})).map((function(t){return Object(a.jsxs)("td",{children:["Amount"===t.name?Object(a.jsx)("span",{children:"$"}):null,Object(a.jsx)("input",{name:t.name,onBlur:function(t){e.handleChange(t,e.i)},onChange:d,className:"tableInput",value:c[t.name]||"",list:t.name}),"Source"===t.name&&e.sourcesState?s(e.sourcesState,t.name):null,"Person"===t.name&&e.personsState?s(e.personsState,t.name):null,"Narrow_category"===t.name&&e.narrowState?s(e.narrowState,t.name):null,"Broad_category"===t.name&&e.broadState?s(e.broadState,t.name):null,"Vendor"===t.name&&e.vendorsState?s(e.vendorsState,t.name):null]})})),Object(a.jsx)("td",{children:Object(a.jsx)("button",{onClick:function(){return e.deleteEntry(c.entry_id||c.id)},children:"Delete"})})]})})}function x(e){return Object(a.jsx)("tbody",{children:Object(a.jsx)("tr",{children:e.fields.filter((function(e){return!e.name.includes("id")})).map((function(t){return Object(a.jsxs)("td",{children:["Amount"===t.name?Object(a.jsx)("span",{children:"$"}):null,Object(a.jsx)("span",{className:"tableInput",children:e.entry[t.name]||""})]},e.i+t.name)}))})})}function g(e){return Object(a.jsxs)("table",{children:[Object(a.jsx)("thead",{children:Object(a.jsx)("tr",{children:e.state.schema.fields.filter((function(e){return!e.name.includes("id")})).map((function(e){return Object(a.jsx)("th",{children:e.name.replace("_"," ")},e.name)}))})}),e.state.data.map((function(t,n){return"pivot"===e.form?Object(a.jsx)(x,{entry:t,i:n,fields:e.state.schema.fields},t.entry_id||t.id):Object(a.jsx)(m,{entry:t,i:n,fields:e.state.schema.fields,handleChange:e.handleChange,sourcesState:e.sourcesState,personsState:e.personsState,broadState:e.broadState,narrowState:e.narrowState,vendorsState:e.vendorsState,setPersonsState:e.setPersonsState,setSourcesState:e.setSourcesState,setBroadState:e.setBroadState,setNarrowState:e.setNarrowState,deleteEntry:e.deleteEntry},n)}))]})}function y(e,t){if(401===e.status)throw new Error("Unauthorized");return"json"===t?e.json():e.text()}var v={expenses:function(e,t){return fetch("/api/expenses/".concat(t.year,"/").concat(t.month),{headers:{authorization:"Bearer ".concat(e)}}).then((function(e){return y(e,"json")}))},deleteExpenses:function(e,t){return fetch("/api/expenses/".concat(t),{method:"DELETE",headers:{authorization:"Bearer ".concat(e)}}).then((function(e){return y(e,"text")}))},updateExpenses:function(e,t){return fetch("/api/expenses/".concat(t.entry_id),{method:"PUT",headers:{authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify(t)}).then((function(e){return y(e,"text")}))},income:function(e,t){return fetch("/api/income/".concat(t.year,"/").concat(t.month),{headers:{authorization:"Bearer ".concat(e)}}).then((function(e){return y(e,"json")}))},updateIncome:function(e,t){return fetch("/api/income/".concat(t.id),{method:"PUT",headers:{authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify(t)}).then((function(e){return y(e,"text")}))},deleteIncome:function(e,t){return fetch("/api/income/".concat(t),{method:"DELETE",headers:{authorization:"Bearer ".concat(e)}}).then((function(e){return y(e,"text")}))},pivot:function(e,t){return fetch("/api/expenses/pivot/".concat(t.year,"/").concat(t.month),{headers:{authorization:"Bearer ".concat(e)}}).then((function(e){return y(e,"json")}))},sources:function(e){return fetch("/api/sources",{headers:{authorization:"Bearer ".concat(e)}}).then((function(e){return y(e,"json")}))},persons:function(e){return fetch("/api/persons",{headers:{authorization:"Bearer ".concat(e)}}).then((function(e){return y(e,"json")}))},narrow:function(e){return fetch("/api/narrows",{headers:{authorization:"Bearer ".concat(e)}}).then((function(e){return y(e,"json")}))},broad:function(e){return fetch("/api/broads",{headers:{authorization:"Bearer ".concat(e)}}).then((function(e){return y(e,"json")}))},vendors:function(e){return fetch("/api/vendors",{headers:{authorization:"Bearer ".concat(e)}}).then((function(e){return y(e,"json")}))},login:function(e){return fetch("/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((function(e){return y(e,"json")}))},checkAuth:function(e){return fetch("/auth/checkAuth",{headers:{authorization:"Bearer ".concat(e)}}).then((function(e){return y(e,"json")}))}};var S=function(){var e,t,n=c.a.useContext(N),o=n.Auth,s=n.setAuth,d=Object(r.useState)({form:"income",year:"",month:""}),l=Object(u.a)(d,2),j=l[0],b=l[1],m=Object(r.useState)({schema:{fields:[]},data:[{Amount:"",Date:"",Source:"",Person:"",id:NaN,source_id:NaN,earner_id:NaN}]}),x=Object(u.a)(m,2),y=x[0],S=x[1],k=Object(r.useState)({schema:{fields:[]},data:[{Amount:"",Date:"",Source:"",Vendor:"",Broad_category:"",Narrow_category:"",Person:"",Notes:"",entry_id:NaN}]}),w=Object(u.a)(k,2),I=w[0],_=w[1],C=Object(r.useState)({schema:{fields:[]},data:[{Amount:"",Broad_category:"",Narrow_category:""}]}),B=Object(u.a)(C,2),L=B[0],E=B[1],T=Object(r.useState)([]),z=Object(u.a)(T,2),A=z[0],P=z[1],U=Object(r.useState)([]),D=Object(u.a)(U,2),F=D[0],G=D[1],J=Object(r.useState)([]),Y=Object(u.a)(J,2),M=Y[0],V=Y[1],R=Object(r.useState)([]),$=Object(u.a)(R,2),H=$[0],W=$[1],q=Object(r.useState)([]),K=Object(u.a)(q,2),Q=K[0],X=K[1];function Z(e){if(e.Date){var t=new Date(e.Date),n=t.getUTCFullYear(),a=(1+t.getUTCMonth()).toString();a=a.length>1?a:"0"+a;var r=t.getUTCDate().toString(),c=a+"/"+(r=r.length>1?r:"0"+r)+"/"+n;return e.Date=c,e}return e}function ee(e){var t=e.target,n=t.name,a=t.value;b(Object(i.a)(Object(i.a)({},j),{},Object(O.a)({},n,a)))}function te(){return(te=Object(f.a)(p.a.mark((function e(t){var n,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.preventDefault(),n=j.form,e.next=5,v[n](o.token,j);case 5:a=e.sent,"pivot"!==n&&(a.data=a.data.map(Z)),e.t0=n,e.next="expenses"===e.t0?10:"income"===e.t0?12:"pivot"===e.t0?14:16;break;case 10:return _(a),e.abrupt("break",16);case 12:return S(a),e.abrupt("break",16);case 14:return E(a),e.abrupt("break",16);case 16:e.next=21;break;case 18:e.prev=18,e.t1=e.catch(0),"Unauthorized"===e.t1.message&&s({type:"LOGOUT"});case 21:case"end":return e.stop()}}),e,null,[[0,18]])})))).apply(this,arguments)}function ne(e,t){var n,a;switch(e){case"Person":n=F,a="person_id";break;case"Source":n=A,a="source_id";break;case"Broad_category":n=M,a="broad_category_id";break;case"Narrow_category":n=H,a="narrow_category_id";break;case"Vendor":n=Q,a="vendor_id"}var r=n.filter((function(e){return e.name===t}))[0];return r?{id:a,dataListItem:r}:{id:null,dataListItem:null}}function ae(){return(ae=Object(f.a)(p.a.mark((function e(t,n){var a,r,c,u,d,l,j,b,f;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.target,r=a.name,c=a.value,u=Object(h.a)(I.data),d=Object(i.a)(Object(i.a)({},u[n]),{},Object(O.a)({},r,c)),"Person"!==r&&"Broad_category"!==r&&"Narrow_category"!==r&&"Vendor"!==r||(l=ne(r,c),j=l.id,b=l.dataListItem,j&&b&&(d=Object(i.a)(Object(i.a)({},d),{},Object(O.a)({},j,b.id)))),u[n]=d,_(Object(i.a)(Object(i.a)({},I),{},{data:u})),e.next=9,v.updateExpenses(o.token,d);case 9:f=e.sent,console.log(f),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),console.error(e.t0),"Unauthorized"===e.t0.message&&s({type:"LOGOUT"});case 17:case"end":return e.stop()}}),e,null,[[0,13]])})))).apply(this,arguments)}function re(){return(re=Object(f.a)(p.a.mark((function e(t,n){var a,r,c,u,d,l,j,b,f;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.target,r=a.name,c=a.value,u=Object(h.a)(y.data),d=Object(i.a)(Object(i.a)({},u[n]),{},Object(O.a)({},r,c)),"Person"!==r&&"Source"!==r||(l=ne(r,c),j=l.id,b=l.dataListItem,j&&b&&(d=Object(i.a)(Object(i.a)({},d),{},Object(O.a)({},j,b.id)))),u[n]=d,S(Object(i.a)(Object(i.a)({},y),{},{data:u})),e.next=9,v.updateIncome(o.token,d);case 9:f=e.sent,console.log(f),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),console.error(e.t0),"Unauthorized"===e.t0.message&&s({type:"LOGOUT"});case 17:case"end":return e.stop()}}),e,null,[[0,13]])})))).apply(this,arguments)}function ce(e){return oe.apply(this,arguments)}function oe(){return(oe=Object(f.a)(p.a.mark((function e(t){var n,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"expenses"!==j.form){e.next=8;break}return e.next=4,v.deleteExpenses(o.token,t);case 4:n=I.data.filter((function(e){return e.entry_id!==t})),_(Object(i.a)(Object(i.a)({},I),{},{data:n})),e.next=13;break;case 8:if("income"!==j.form){e.next=13;break}return e.next=11,v.deleteIncome(o.token,t);case 11:a=y.data.filter((function(e){return e.id!==t})),S(Object(i.a)(Object(i.a)({},y),{},{data:a}));case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(0),console.error(e.t0),"Unauthorized"===e.t0&&s({type:"LOGOUT"});case 19:case"end":return e.stop()}}),e,null,[[0,15]])})))).apply(this,arguments)}return Object(r.useEffect)((function(){function e(){return(e=Object(f.a)(p.a.mark((function e(){var t,n,a,r,c,s;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.sources(o.token);case 2:return t=e.sent,n=t.data,P(n),e.next=7,v.persons(o.token);case 7:return a=e.sent,G(a.data),e.next=11,v.narrow(o.token);case 11:return r=e.sent,W(r.data),e.next=15,v.broad(o.token);case 15:return c=e.sent,V(c.data),e.next=19,v.vendors(o.token);case 19:s=e.sent,X(s.data);case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),Object(a.jsxs)("div",{className:"Home",children:[Object(a.jsxs)("header",{className:"header",children:[Object(a.jsx)("button",{className:"logout",onClick:function(){return s({type:"LOGOUT"})},children:"Logout"}),Object(a.jsx)("h1",{children:"Finances!"}),o.token?Object(a.jsx)("img",{src:"/wallchart",alt:"Wall Chart"}):null,Object(a.jsxs)("form",{onSubmit:function(e){return te.apply(this,arguments)},className:"form-inline",children:[Object(a.jsxs)("select",{name:"form",value:j.form,onChange:ee,children:[Object(a.jsx)("option",{value:"income",children:"Income"}),Object(a.jsx)("option",{value:"expenses",children:"Expenses"}),Object(a.jsx)("option",{value:"pivot",children:"Pivot Table"})]}),Object(a.jsx)("label",{htmlFor:"year2",children:"Year"}),Object(a.jsx)("input",{onChange:ee,value:j.year,type:"text",id:"year2",className:"form-control",name:"year",placeholder:"YYYY"}),Object(a.jsx)("label",{htmlFor:"month2",children:"Month"}),Object(a.jsx)("input",{onChange:ee,value:j.month,type:"text",id:"month2",className:"form-control",name:"month",placeholder:"MM"}),Object(a.jsx)("button",{className:"btn btn-success",children:"Submit"})]})]}),Object(a.jsxs)("div",{className:"body",children:["income"===j.form&&(null===(e=y.data[0])||void 0===e?void 0:e.id)?Object(a.jsx)(g,{state:y,sourcesState:A,personsState:F,handleChange:function(e,t){return re.apply(this,arguments)},setSourcesState:P,setPersonsState:G,deleteEntry:ce,form:j.form}):null,"expenses"===j.form&&(null===(t=I.data[0])||void 0===t?void 0:t.entry_id)?Object(a.jsx)(g,{state:I,personsState:F,broadState:M,narrowState:H,vendorsState:Q,handleChange:function(e,t){return ae.apply(this,arguments)},setPersonsState:G,setBroadState:V,setNarrowState:W,deleteEntry:ce,form:j.form}):null,"pivot"===j.form&&L?Object(a.jsx)(g,{state:L,deleteEntry:ce,handleChange:function(){return!1},form:j.form}):null]})]})};function k(){var e=c.a.useContext(N),t=e.Auth,n=e.setAuth,o=Object(r.useState)({username:"",password:""}),s=Object(u.a)(o,2),d=s[0],j=s[1],h=Object(r.useState)(!1),b=Object(u.a)(h,2),p=b[0],f=b[1],m=function(e){var t=e.target,n=t.name,a=t.value;j(Object(i.a)(Object(i.a)({},d),{},Object(O.a)({},n,a)))};return t.loggedIn?Object(a.jsx)(l.a,{to:"/"}):Object(a.jsx)(a.Fragment,{children:Object(a.jsx)("div",{className:"Login",children:Object(a.jsxs)("form",{className:"LoginForm",onSubmit:function(e){e.preventDefault(),v.login(d).then((function(e){n({type:"LOGIN",payload:{user:"blarvis",token:e.token}})})).catch((function(e){return f(!0)}))},children:[Object(a.jsx)("h4",{children:"Login"}),Object(a.jsx)("div",{className:"Response",children:p?Object(a.jsx)("p",{children:"Incorrect username or password"}):null}),Object(a.jsx)("input",{onChange:m,value:d.username,type:"text",name:"username",placeholder:"username"}),Object(a.jsx)("input",{onChange:m,value:d.password,type:"password",name:"password",placeholder:"password"}),Object(a.jsx)("button",{className:"Btn",name:"login",type:"submit",children:"Login"})]})})})}n(38);var w=function(e){var t=e.component,n=e.loggedIn,r=Object(d.a)(e,["component","loggedIn"]);return Object(a.jsx)(l.b,Object(i.a)(Object(i.a)({},r),{},{render:function(e){return n?Object(a.jsx)(t,Object(i.a)({},e)):Object(a.jsx)(l.a,{to:"/login"})}}))},N=c.a.createContext({Auth:{loggedIn:!1,user:"",token:""},setAuth:function(){}}),I=function(e,t){return"LOGIN"===t.type&&t.payload?(localStorage.setItem("user",JSON.stringify(t.payload.user)),localStorage.setItem("token",JSON.stringify(t.payload.token)),Object(i.a)(Object(i.a)({},e),{},{loggedIn:!0,user:t.payload.user,token:t.payload.token})):"LOGOUT"===t.type?(localStorage.clear(),Object(i.a)(Object(i.a)({},e),{},{loggedIn:!1,user:"",token:""})):e};function _(){var e=c.a.useReducer(I,{loggedIn:!1,user:"",token:""}),t=Object(u.a)(e,2),n=t[0],o=t[1];return Object(r.useEffect)((function(){var e=localStorage.getItem("token");v.checkAuth(e).then((function(e){return o({type:"LOGIN",payload:{user:e.username,token:e.token}})})).catch((function(e){o({type:"LOGOUT"})}))}),[]),Object(a.jsx)(N.Provider,{value:{Auth:n,setAuth:o},children:Object(a.jsxs)(j.a,{children:[Object(a.jsx)(w,{path:"/",loggedIn:n.loggedIn,setLoggedIn:o,component:S}),Object(a.jsx)(l.b,{exact:!0,path:"/login",children:Object(a.jsx)(k,{})})]})})}var C=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,40)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,c=t.getLCP,o=t.getTTFB;n(e),a(e),r(e),c(e),o(e)}))};s.a.render(Object(a.jsx)(c.a.StrictMode,{children:Object(a.jsx)(_,{})}),document.getElementById("root")),C()}},[[39,1,2]]]);
//# sourceMappingURL=main.11e048da.chunk.js.map